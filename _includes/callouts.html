<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll("blockquote").forEach(function (bq) {
    const first = bq.querySelector("p:first-child");
    if (!first) return;

    const match = first.innerHTML.match(/^\[!(NOTE|ABSTRACT|SUMMARY|TLDR|TIP|HINT|WARNING|CAUTION|ATTENTION|DANGER|FAILURE|FAIL|MISSING|ERROR|INFO|TODO|SUCCESS|CHECK|DONE|QUESTION|HELP|FAQ|IMPORTANT|BUG|EXAMPLE|QUOTE|CITE)\](<br>|&lt;br&gt;)?\s*/i);
    if (!match) return;

    // Mapear aliases a tipos principales
    const typeMap = {
      abstract: "note", summary: "note", tldr: "note",
      hint: "tip", todo: "info",
      attention: "warning", failure: "danger", fail: "danger", missing: "danger", error: "danger",
      check: "success", done: "success",
      help: "question", faq: "question",
      cite: "quote"
    };
    
    let type = match[1].toLowerCase();
    type = typeMap[type] || type;
    first.innerHTML = first.innerHTML.replace(match[0], "");

    // Extraer t√≠tulo personalizado si lo hay
    // > [!NOTE] Mi t√≠tulo personalizado
    const titleMatch = first.innerHTML.match(/^([^\n<]+)/);
    const customTitle = titleMatch ? titleMatch[1].trim() : null;
    if (customTitle) first.innerHTML = first.innerHTML.replace(customTitle, "");

    const icons = {
      note: "üìù", tip: "üí°", warning: "‚ö†Ô∏è", danger: "üî•",
      info: "‚ÑπÔ∏è", success: "‚úÖ", question: "‚ùì", caution: "‚ö†Ô∏è",
      important: "‚ùó", bug: "üêõ", example: "üìã", quote: "üí¨"
    };

    const labels = {
      note: "Nota", tip: "Consejo", warning: "Aviso", danger: "Peligro",
      info: "Informaci√≥n", success: "Hecho", question: "Pregunta",
      caution: "Atenci√≥n", important: "Importante", bug: "Error",
      example: "Ejemplo", quote: "Cita"
    };

    bq.classList.add("callout", "callout-" + type);

    const header = document.createElement("div");
    header.classList.add("callout-header");
    header.innerHTML = `<span class="callout-icon">${icons[type]}</span>
                        <span class="callout-title">${customTitle || labels[type]}</span>`;
    bq.prepend(header);
  });
});
</script>