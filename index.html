---
layout: default
title: "Avisos 5S/6F 2M-B"
excerpt: "Aquí se publica información de relevancia de la Delegación del Grupo 6F2M-B del Grado en Ingeniería
Informática de la Escuela Técnica Superior de Ingenieros Informáticos de la Universidad Politécnica de Madrid."
---
<h1>Últimos avisos</h1>

<!-- MODO OSCURO TEMPORALMENTE DESHABILITADO
<div id="aviso-modo-oscuro" class="aviso-modo-oscuro" style="display: none;">
</div>
-->

<div class="avisos-container">
  {% assign now = 'now' | date: "%s" %}
  {% assign active_posts = 0 %}
  {% for post in site.posts %}
  {% assign post_expires = post.expires | date: "%s" %}
  {% if post_expires == nil or post_expires > now %}
  {% assign active_posts = active_posts | plus: 1 %}
  {% if post.last_modified_at %}
  {% assign modified_date = post.last_modified_at | date_to_xmlschema %}
  {% else %}
  {% assign modified_date = post.date | date_to_xmlschema %}
  {% endif %}
  <div data-post-url="{{ site.baseurl }}{{ post.url }}" data-date-modified="{{ modified_date }}" class="aviso-activo">
    <a href="{{ site.baseurl }}{{ post.url }}?utm_source=web&utm_medium=link&utm_campaign=avisos">{{ post.title }}</a>
    <span class="aviso-fecha">
      {{ post.date | date: "%d/%m/%Y" }}
      {% if post.expires %} · Caduca el {{ post.expires | date: "%d/%m/%Y a las %H:%M (%z)" }}{% endif %}
    </span>
  </div>
  {% endif %}
  {% endfor %}
  {% if active_posts == 0 %}
  <div class="sin-avisos">
    Sin avisos activos en este momento.
  </div>
  {% endif %}
  <div class="avisos-retirados">
    <a href="https://github.com/ggelado/avisos5S2M-B/tree/main/_posts" target="_blank" rel="noopener noreferrer">
      Avisos retirados (información posiblemente desactualizada)
    </a>
  </div>
</div>


{% if site.data.future_posts and site.data.future_posts.size > 0 %}
<details class="proximos-avisos">
  <summary>Próximos avisos</summary>

  <div class="proximos-lista">
    {% for post in site.data.future_posts %}
    <div class="futuro-aviso">
      <div class="futuro-aviso-titulo">{{ post.title }}</div>
      {% if post.excerpt %}
      <div class="futuro-aviso-excerpt">
        {{ post.excerpt | truncatewords: 20 }}
      </div>
      {% endif %}
      <span class="futuro-aviso-fecha">
        Se publicará el {{ post.date | date: "%d/%m/%Y" }}
        {% if post.expires %} · Caduca el {{ post.expires | date: "%d/%m/%Y" }}{% endif %}
      </span>
    </div>
    {% endfor %}
  </div>
</details>
{% endif %}

<p>Recuerda que esta web se actualiza regularmente. Puedes suscribirte al <a href="{{ site.baseurl }}/feed.xml">feed
    RSS</a> para recibir las últimas noticias directamente en tu lector de RSS. También puedes consultarlos desde <a
    href="https://calendar.google.com/calendar/r?cid=webcal%3A%2F%2Fggelado.github.io%2Favisos5S2M-B%2Favisos.ics">Google
    Calendar</a> o tu <a href="webcal://ggelado.github.io/avisos5S2M-B/avisos.ics"> calendario favorito</a>. ¿No te parece suficiente? También
    tienes a tu disposición hasta un bot de <a href="https://discord.com/oauth2/authorize?client_id=1464244457049424079&permissions=2048&integration_type=0&scope=bot">Discord</a>.
    No hay excusas.</p>
<p>Y ya que estamos, si te interesa el proyecto o tienes alguna idea <a href="https://github.com/ggelado/avisos5S2M-B/fork">COLABORA</a>.</p>
<p>Más info sobre el proyecto en el <a href="{{ site.baseurl }}/README">README</a>.</p>
<p class="notificacion-banner">
  Nuevo sistema de notificaciones push
  <a href="https://notifierpushrss.onrender.com/" target="_blank" rel="noopener noreferrer">Accede aquí</a>
</p>

<p>Enlaces de utilidad:</p>
<div class="enlaces-utilidad">
  <a href="https://stats.uptimerobot.com/OuKYf98R4h" target="_blank" rel="noopener noreferrer">
    Estado de los principales servicios
  </a>

  <a href="https://crtm.es/comunicacion/actualidad-del-servicio/avisos/informacion-actualizada?lang=es" target="_blank"
    rel="noopener noreferrer">
    Estado del Transporte Público
  </a>
</div>

<!-- BLOQUE WIDGETS -->
<div class="widgets-container">
  <div class="widgets-grid">
    <!-- AEMET -->
    <div class="widget">
      <div class="widget-contenido widget-aemet">
        <iframe title="El tiempo AEMET"
          src="https://www.aemet.es/es/eltiempo/prediccion/municipios/mostrarwidget/boadilla-del-monte-id28022?w=g2p101010011ovmffffffx4f86d9t95b6e9r0s8n1"
          style="width:100%; height:100%; border:0;" scrolling="no" loading="lazy">
        </iframe>
      </div>
    </div>

    <!-- CRTM -->
    <div class="widget">
      <div class="widget-contenido widget-crtm">
        <div id="estado-crtm" style="text-align:center;">
          Cargando estado del servicio…
        </div>
      </div>

      <div class="widget-contenido widget-buses" id="buses-simplificado">
        Cargando próximos transportes…
      </div>
      <div class="widget-buses-label">
        <a href="/avisos5S2M-B/comoLlegar.html">
          ¿Y para ir?
        </a>
      </div>
    </div>
  </div>
</div>
<!-- FIN BLOQUE WIDGETS -->





<p>>Si quieres publicar un aviso accede <a href="/avisos5S2M-B/publicarAvisos.html">aquí</a>.</p>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  .widget-aemet {
    position: relative;
  }

  /* MODO OSCURO TEMPORALMENTE DESHABILITADO
@media (prefers-color-scheme: dark) {
  .widget-aemet::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.35);
    pointer-events: none;
    z-index: 1;
  }
}
*/


  /* MODO OSCURO TEMPORALMENTE DESHABILITADO
  .aviso-modo-oscuro {
    display: inline-block;
    margin: 4px 0 10px;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.2px;
    color: #7c2d12;
    background: #ffedd5;
    border: 1px solid #fdba74;
  }
  */
</style>




<!-- MODO OSCURO TEMPORALMENTE DESHABILITADO
<script>
  // Aviso condicional para modo oscuro
  document.addEventListener("DOMContentLoaded", () => {
    const aviso = document.getElementById("aviso-modo-oscuro");
    if (!aviso) return;

    if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
      aviso.textContent = "Modo oscuro en beta. Podría haber errores o no cumplir contrastes WCAG.";
      aviso.style.display = "block";
    } else {
      aviso.style.display = "none";
    }
  });
</script>
-->
{% include proximos_buses.html %}

<script>
  async function actualizarBusesSimplificados() {
    const contenedor = document.getElementById('buses-simplificado');
    if (!contenedor) return;

    const SOURCES = [
      { url: "https://api.madridtransporte.com/stops/bus/08771/times", lines: ["571", "573", "N905"] },
      { url: "https://api.madridtransporte.com/stops/bus/08411/times", lines: ["591"] },
      { url: "https://api.madridtransporte.com/stops/bus/17573/times", lines: ["865"] },
      {
        url: "https://api.madridtransporte.com/stops/tram/29/times",
        lines: null,
        isTram: true
      }
    ];

    function minutesFromNow(ts) {
      return Math.max(0, Math.round((ts - Date.now()) / 60000));
    }

    function isWeekday(date = new Date()) {
      const d = date.getDay();
      return d >= 1 && d <= 5; // L-V
    }


    function minutesUntilTodayTime(hhmm) {
      const [h, m] = hhmm.split(":").map(Number);
      const now = new Date();
      const t = new Date();
      t.setHours(h, m, 0, 0);
      return Math.round((t - now) / 60000);
    }

    function uniqueSorted(arr) {
      return [...new Set(arr)].sort((a, b) => a - b);
    }

    try {
      const results = [];

      for (const source of SOURCES) {
        try {
          const res = await fetch(source.url);
          const data = await res.json();

          if (source.isTram) {
            for (const arrival of data.arrives || []) {
              if (arrival.direction !== 2) continue;
              const times = uniqueSorted(arrival.estimatedArrives || []);
              times.forEach(ts => {
                results.push({
                  line: "ML3",
                  minutes: minutesFromNow(ts)
                });
              });
            }
            continue;
          }

          for (const arrival of data.arrives || []) {
            if (source.lines && !source.lines.includes(arrival.line)) continue;
            const times = uniqueSorted(arrival.estimatedArrives || []);
            times.forEach(ts => {
              results.push({
                line: arrival.line,
                minutes: minutesFromNow(ts)
              });
            });
          }

        } catch (e) {
        }
      }

      if (isWeekday()) {
        SHUTTLES.forEach(shuttle => {
          shuttle.times.forEach(time => {
            const minutes = minutesUntilTodayTime(time);

            // solo mostrar cuando quede menos de 1h
            if (minutes > 0 && minutes <= 60) {
              results.push({
                line: shuttle.line,
                lineCode: shuttle.line,
                destination: shuttle.destination,
                minutes,
                isTram: true
              });
            }
          });
        });
      }

      const sorted = results.sort((a, b) => a.minutes - b.minutes);

      if (sorted.length === 0) {
        contenedor.innerHTML = 'No hay buses próximos';
        return;
      }

      const primerosLlegadas = sorted.slice(0, 5);
      const html = primerosLlegadas.map(a =>
        `<span><strong>${a.line}</strong>: <span class="bus-time">${a.minutes}'</span></span>`
      ).join(' · ');

      contenedor.innerHTML = html;

    } catch (err) {
      contenedor.innerHTML = 'API CRTM caída. Actualiza la web.';
    }
  }

  // Actualizar al cargar y cada minuto
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(actualizarBusesSimplificados, 1000);
    setInterval(actualizarBusesSimplificados, 60000);
  });
</script>
{% include popup_notis.html %}
{% include logica_crtm.html %}

<!-- Resaltado de avisos no visualizados -->
<script>
  (() => {
    const items = document.querySelectorAll("[data-post-url]");
    items.forEach(div => {
      const url = div.dataset.postUrl;
      const dateModified = div.dataset.dateModified;
      const link = div.querySelector("a");
      if (!link) return;

      if (isPostModifiedSinceLastVisit(url, dateModified)) {
        // No leído → naranja (ya viene del estilo inline, no hace falta tocarlo)
        const star = document.createElement("span");
        star.textContent = "★ ";
        star.style.color = "#f59e0b";
        link.prepend(star);
      } else {
        // Leído → azul/purple
        div.classList.add('aviso-visto');
      }
    });
  })();
</script>






